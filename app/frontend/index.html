<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentMove Demo - åŸºäºLLMçš„é›¶æ ·æœ¬ä½ç½®é¢„æµ‹</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ğŸ¤– AgentMove Demo</h1>
                <p class="subtitle">åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„é›¶æ ·æœ¬ä¸‹ä¸€ä½ç½®é¢„æµ‹ (NAACL 2025)</p>
            </div>
            <div class="header-status">
                <span id="status-indicator" class="status-indicator">âšª è¿æ¥ä¸­...</span>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel: Map -->
            <div class="map-panel">
                <div id="map" class="map-container"></div>
                <div class="map-legend">
                    <h4>å›¾ä¾‹</h4>
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #3388ff;">ğŸ”µ</span>
                        <span>å†å²è½¨è¿¹ç‚¹</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #ff3333;">ğŸ”´</span>
                        <span>é¢„æµ‹ä½ç½®</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #33ff33;">ğŸŸ¢</span>
                        <span>çœŸå®ä½ç½®</span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Controls and Results -->
            <div class="control-panel">
                <!-- Configuration Section -->
                <div class="panel-section">
                    <h3>âš™ï¸ é…ç½®</h3>

                    <div class="form-group">
                        <label for="city-select">åŸå¸‚</label>
                        <select id="city-select" class="form-control">
                            <option value="Shanghai">ä¸Šæµ· (Shanghai)</option>
                            <option value="Beijing">åŒ—äº¬ (Beijing)</option>
                            <option value="Tokyo">ä¸œäº¬ (Tokyo)</option>
                            <option value="NewYork">çº½çº¦ (NewYork)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="model-select">LLM æ¨¡å‹</label>
                        <select id="model-select" class="form-control">
                            <optgroup label="SiliconFlow (å…è´¹)">
                                <option value="qwen2.5-7b" selected>Qwen 2.5-7B</option>
                                <option value="qwen2.5-72b">Qwen 2.5-72B</option>
                                <option value="glm4-9b">GLM-4-9B</option>
                                <option value="deepseekv2">DeepSeek V2</option>
                            </optgroup>
                            <optgroup label="DeepInfra">
                                <option value="llama4-17b">Llama 4-17B</option>
                                <option value="llama3.1-8b">Llama 3.1-8B</option>
                                <option value="gemma2-9b">Gemma 2-9B</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="prompt-select">é¢„æµ‹æ–¹æ³•</label>
                        <select id="prompt-select" class="form-control">
                            <option value="agent_move_v6">AgentMove (å®Œæ•´æ¡†æ¶)</option>
                            <option value="llmmove">LLM-Move Baseline</option>
                            <option value="llmzs">LLM-ZS Baseline</option>
                            <option value="llmmob">LLM-Mob Baseline</option>
                        </select>
                    </div>
                </div>

                <!-- Trajectory Selection -->
                <div class="panel-section">
                    <h3>ğŸ“ è½¨è¿¹é€‰æ‹©</h3>

                    <!-- Tab Navigation -->
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="browse">æµè§ˆæ•°æ®é›†</button>
                        <button class="tab-btn" data-tab="create">åˆ›å»ºè½¨è¿¹</button>
                    </div>

                    <!-- Browse Dataset Tab -->
                    <div id="browse-tab" class="tab-content active">
                        <div class="form-group">
                            <label for="user-search">æœç´¢ç”¨æˆ·ID</label>
                            <input type="text" id="user-search" class="form-control" placeholder="è¾“å…¥ç”¨æˆ·IDæœç´¢...">
                        </div>

                        <div class="form-group">
                            <label for="trajectory-filter-min">è½¨è¿¹é•¿åº¦ç­›é€‰</label>
                            <div class="filter-row">
                                <input type="number" id="trajectory-filter-min" class="form-control" placeholder="æœ€å°" min="1" style="width: 45%;">
                                <span style="margin: 0 5px;">-</span>
                                <input type="number" id="trajectory-filter-max" class="form-control" placeholder="æœ€å¤§" min="1" style="width: 45%;">
                            </div>
                        </div>

                        <div class="button-group">
                            <button id="load-users-btn" class="btn btn-secondary">
                                åŠ è½½ç”¨æˆ·åˆ—è¡¨
                            </button>
                            <button id="random-trajectory-btn" class="btn btn-secondary">
                                éšæœºé€‰æ‹©
                            </button>
                        </div>

                        <!-- User List -->
                        <div id="user-list-container" class="user-list-container" style="display: none;">
                            <h4>ç”¨æˆ·åˆ—è¡¨</h4>
                            <div id="user-list" class="user-list"></div>
                        </div>

                        <!-- Trajectory List (shown when user is selected) -->
                        <div id="trajectory-list-container" class="trajectory-list-container" style="display: none;">
                            <h4>è½¨è¿¹åˆ—è¡¨ <span id="selected-user-name"></span></h4>
                            <div id="trajectory-list" class="trajectory-list"></div>
                        </div>

                        <!-- Legacy dropdown (kept for backward compatibility) -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="trajectory-select">å¿«é€Ÿé€‰æ‹©</label>
                            <select id="trajectory-select" class="form-control">
                                <option value="">åŠ è½½ä¸­...</option>
                            </select>
                        </div>

                        <div class="button-group">
                            <button id="load-trajectory-btn" class="btn btn-secondary">
                                æŸ¥çœ‹è½¨è¿¹
                            </button>
                        </div>
                    </div>

                    <!-- Create Trajectory Tab -->
                    <div id="create-tab" class="tab-content">
                        <!-- Input Mode Selection -->
                        <div class="form-group">
                            <label>è¾“å…¥æ–¹å¼</label>
                            <div class="button-group">
                                <button class="btn btn-secondary input-mode-btn active" data-mode="map">åœ°å›¾ç‚¹å‡»</button>
                                <button class="btn btn-secondary input-mode-btn" data-mode="form">è¡¨å•è¾“å…¥</button>
                                <button class="btn btn-secondary input-mode-btn" data-mode="json">JSONå¯¼å…¥</button>
                            </div>
                        </div>

                        <!-- Map Click Mode -->
                        <div id="input-mode-map" class="input-mode-content active">
                            <div class="form-hint">
                                <p>ğŸ’¡ ç‚¹å‡»åœ°å›¾æ·»åŠ è½¨è¿¹ç‚¹ã€‚ç‚¹å‡»å·²æ·»åŠ çš„ç‚¹å¯ä»¥ç¼–è¾‘æˆ–åˆ é™¤ã€‚</p>
                            </div>
                            <div class="button-group">
                                <button id="clear-custom-trajectory-btn" class="btn btn-secondary">
                                    æ¸…é™¤æ‰€æœ‰ç‚¹
                                </button>
                            </div>
                            <div id="custom-points-list" class="custom-points-list"></div>
                        </div>

                        <!-- Form Input Mode -->
                        <div id="input-mode-form" class="input-mode-content">
                            <div class="form-group">
                                <button id="add-point-form-btn" class="btn btn-secondary">
                                    + æ·»åŠ è½¨è¿¹ç‚¹
                                </button>
                            </div>
                            <div id="form-points-container" class="form-points-container"></div>
                        </div>

                        <!-- JSON Import Mode -->
                        <div id="input-mode-json" class="input-mode-content">
                            <div class="form-group">
                                <label for="json-input">ç²˜è´´JSONæ ¼å¼è½¨è¿¹æ•°æ®</label>
                                <textarea id="json-input" class="form-control" rows="10" placeholder='{"user_id": "custom_user", "trajectory_points": [{"timestamp": "2024-11-25T08:30:00", "latitude": 31.2304, "longitude": 121.4737, "category": "Residence"}, ...]}'></textarea>
                                <small class="form-hint">JSONæ ¼å¼ç¤ºä¾‹å·²æ˜¾ç¤ºåœ¨ä¸‹æ–¹</small>
                            </div>
                            <div class="form-group">
                                <button id="validate-json-btn" class="btn btn-secondary">
                                    éªŒè¯JSON
                                </button>
                                <button id="import-json-btn" class="btn btn-primary">
                                    å¯¼å…¥è½¨è¿¹
                                </button>
                            </div>
                            <div id="json-validation-result" class="validation-result"></div>
                            <details class="json-example">
                                <summary>æŸ¥çœ‹JSONæ ¼å¼ç¤ºä¾‹</summary>
                                <pre id="json-example-code">{
  "user_id": "custom_user_1",
  "trajectory_points": [
    {
      "timestamp": "2024-11-25T08:30:00",
      "latitude": 31.2304,
      "longitude": 121.4737,
      "category": "Residence",
      "venue_id": 1,
      "address": "Pudong, Lujiazui, Home, Century Avenue"
    },
    {
      "timestamp": "2024-11-25T09:15:00",
      "latitude": 31.2397,
      "longitude": 121.4990,
      "category": "Office",
      "venue_id": 2,
      "address": "Pudong, Lujiazui, Office Tower, Yincheng Road"
    }
  ]
}</pre>
                            </details>
                        </div>

                        <!-- Custom Trajectory Actions -->
                        <div class="button-group" style="margin-top: 15px;">
                            <button id="preview-custom-trajectory-btn" class="btn btn-secondary">
                                é¢„è§ˆè½¨è¿¹
                            </button>
                            <button id="save-custom-trajectory-btn" class="btn btn-primary">
                                ä¿å­˜å¹¶ä½¿ç”¨
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="panel-section">
                    <h3>ğŸš€ æ“ä½œ</h3>

                    <button id="predict-btn" class="btn btn-primary btn-large">
                        å¼€å§‹é¢„æµ‹
                    </button>

                    <button id="example-btn" class="btn btn-secondary">
                        åŠ è½½ç¤ºä¾‹
                    </button>
                </div>

                <!-- Results Section -->
                <div id="results-section" class="panel-section" style="display: none;">
                    <h3>ğŸ“Š é¢„æµ‹ç»“æœ</h3>

                    <div class="result-card">
                        <div class="result-header">
                            <span class="result-label">é¢„æµ‹ä½ç½® ID:</span>
                            <span id="prediction-venue" class="result-value">-</span>
                        </div>
                        <div class="result-header">
                            <span class="result-label">çœŸå®ä½ç½® ID:</span>
                            <span id="ground-truth-venue" class="result-value">-</span>
                        </div>
                        <div class="result-match" id="prediction-match"></div>
                    </div>

                    <div class="result-explanation">
                        <h4>æ¨ç†è¿‡ç¨‹</h4>
                        <p id="prediction-reason" class="reasoning-text"></p>
                    </div>

                    <!-- Module Details (Collapsible) -->
                    <details class="module-details">
                        <summary>ğŸ” æ¨¡å—è¯¦æƒ…</summary>
                        <div class="module-content">
                            <div class="module-section">
                                <h5>ğŸ§  ä¸ªäººè®°å¿†æ¨¡å—</h5>
                                <pre id="memory-output" class="module-output"></pre>
                            </div>
                            <div class="module-section">
                                <h5>ğŸŒ ç©ºé—´ä¸–ç•Œæ¨¡å‹</h5>
                                <pre id="spatial-output" class="module-output"></pre>
                            </div>
                            <div class="module-section">
                                <h5>ğŸ‘¥ ç¤¾ä¼šçŸ¥è¯†æ¨¡å—</h5>
                                <pre id="social-output" class="module-output"></pre>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- Loading Indicator -->
                <div id="loading-indicator" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>é¢„æµ‹ä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>AgentMove: A Large Language Model based Agentic Framework for Zero-shot Next Location Prediction</p>
            <p>
                <a href="https://arxiv.org/abs/2408.13986" target="_blank">ğŸ“„ è®ºæ–‡</a> |
                <a href="https://github.com/tsinghua-fib-lab/AgentMove" target="_blank">ğŸ’» GitHub</a> |
                <a href="/api/docs" target="_blank">ğŸ“š API æ–‡æ¡£</a>
            </p>
        </footer>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom JS -->
    <script src="/static/js/main.js"></script>
</body>
</html>
